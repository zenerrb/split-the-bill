<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Split the Bill</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI=" crossorigin="anonymous"></script>
		<style>
			textarea {
				height: 50vh;
				resize: none;
			}
		</style>
		<script>
			$(document).ready(function(){
				$("#split-button").click(function(){
					$("#share-table tbody").empty();
					
					var lineItems = $("#line-items-textarea").val().split("\n");
					
					if(typeof(lineItems[0]) === 'undefined') {
						return null;
					}
					else {
						var nameToShareMap = new Map();
						var totalCost = 0;
						
						$.each(lineItems, function( index, row ) {
							var rowItems = row.split(",");
							var cost = +(rowItems[0]);
							var namesPipeDelimited = rowItems[2];
							var names = namesPipeDelimited.split("|");
							var sharePerPerson = cost / names.length;
							
							addToEachName(nameToShareMap, sharePerPerson, names);
							totalCost += cost;
						});
						
						var shareSum = 0;
						for (var [name, share] of nameToShareMap.entries()) {
							var shareRounded = +(share.toFixed(2));
							shareSum += shareRounded;
							$("#share-table tbody").append(rowHtml(name, shareRounded));
						}
						$("#total-cost").html("<h3>Total cost: " + totalCost + "</h3>");
						$("#share-table tbody").append(rowHtml("Sum", shareSum));
					}
				});
			});
			
			function addToEachName(nameToShareMap, additionalShare, names) {
				$.each(names, function( index, name ) {
					var currentShare = 0;
					
					if (nameToShareMap.has(name)) {
						currentShare = nameToShareMap.get(name);
					}
					
					nameToShareMap.set(name, currentShare + additionalShare);
				});
			}
			
			function rowHtml(name, share) {
				return `
					<tr>
						<td>${name}</td>
						<td>$ ${share.toFixed(2)}</td>
					</tr>
				`
			}
		</script>
		
	</head>
	<body>
		<div class="p-5 bg-primary text-white text-center">
			<h1>Split the Bill</h1>
		</div>
		<div class="container mt-5">
			<h2><span class="label label-default">Line items</span></h2>
			<textarea id="line-items-textarea" class="form-control" placeholder="CSV format (Cost,Description,Pipe-delimited list of names)"></textarea>
			
			<div id="total-cost" class="mt-3">
			</div>
			
			<div class="mt-3">
				<button id="split-button" class="btn btn-primary" type="button">Split the bill</button>
			</div>
			
			<table id="share-table" class="table table-striped mt-3">
				<thead>
					<tr>
						<th class="th-lg">Name</th>
						<th>Share</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
	</body>
</html>
